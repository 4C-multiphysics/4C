#-------------------------------------------------------------------------------
# Define global variables for all jobs
#-------------------------------------------------------------------------------

variables:
    # Clone repository by default, file have changed attribute.
    GIT_STRATEGY: clone
    # If not called by a scheduler this variable has to be 0.
    # 1: daily full
    # 2: daily debug
    # 3: weekly coverage
    GITLAB_SCHEDULER_TYPE: "0"

    # Build type for pipelines started via the GitLab GUI
    # Options:
    # - "release" (default)
    # - "debug"
    CTEST_BUILD_TYPE_GITLAB: "release"

    # Prefix for do-configure.
    CTEST_CONFIGURE_PREFIX: ""

    # Postfix for do-configure.
    CTEST_CONFIGURE_POSTFIX: "--useDEAL"

    # Select specific test by regular expressen (".": all)
    TEST_TAG: "."

    # Temporary exclude postprocessing tests at IMCS.
    CTEST_EXCLUDE_STRING: ""

    # Flag to specify if pipeline fails on warning (0:no, 1:yes)
    CTEST_FAIL_ON_WARNING: "1"

    # Flags for additional pipelines (daily full) performed only if set (used of the clusters) (0:no, 1:yes)
    GITLAB_SCHEDULER_LNM_SCHMARRN: "0"
    GITLAB_SCHEDULER_LNM_DEEP: "0"
    GITLAB_SCHEDULER_LNM_BRUTEFORCE: "0"

#-------------------------------------------------------------------------------
# Define the base jobs for testing
#-------------------------------------------------------------------------------

# This kind of job is started when something changes in the master branch.
# Minimal tests are performed.
.buildtest_minimal: &buildtest_minimal
    stage: buildtest
    variables:
        # So the old build can be used again.
        GIT_STRATEGY: fetch
    script:
        - "echo minimal test: triggered by change in master"
        # Delete old build files.
        - rm -rf ../baci-build/
        # Clear eventual ccache cache.
        - 'if [ -x "$(command -v ccache)" ]; then ccache -C -z; echo "ccache cache cleared"; fi'
        - ctest -S $CI_PROJECT_DIR/tests/testconfig/test_release.cmake -VV -L minimal | tee ../buildtest_minimal.log | grep -e "^MakeCommand" -e "^\[" -e "^\[" -e "Compiler " -e "\*\*\*Failed" -e "\.\.\.   Passed" -e " tests passed\,"
    after_script:
        # Move the log file to the source folder, so it can be found by artifacts.
        - mv ../buildtest_minimal.log buildtest_minimal.log
    artifacts:
        name: "$CI_JOB_NAME-$CI_JOB_ID"
        paths:
            - buildtest_minimal.log
        when: on_failure
        expire_in: 4 weeks
    only:
        - master
    except:
        refs:
            - schedules
            - web
        variables:
            - $GITLAB_SCHEDULER_TYPE == "1"
            - $GITLAB_SCHEDULER_TYPE == "2"
            - $GITLAB_SCHEDULER_TYPE == "3"

# This kind of job is started when a user triggers a job in the gitlab UI.
# Full tests are performed.
.buildtest_full: &buildtest_full
    stage: buildtest
    script:
        # Specify which configuration is tested by this pipeline
        - "echo Baci build type: $CTEST_BUILD_TYPE_GITLAB"
        - "echo Run tests matching expression: $TEST_TAG [{.} all tests, {} no test]"
        - "echo Excluded tests: $CTEST_EXCLUDE_STRING [{} no test excluded]"
        # Delete old build files.
        - rm -rf ../baci-build/
        # Clear eventual ccache cache.
        - 'if [ -x "$(command -v ccache)" ]; then ccache -C -z; echo "ccache cache cleared"; fi'
        # Output to log because it is too much for the gitlab console.
        - 'ctest -S $CI_PROJECT_DIR/tests/testconfig/test_${CTEST_BUILD_TYPE_GITLAB}.cmake -VV -E "$CTEST_EXCLUDE_STRING" -R "$TEST_TAG" | tee ../buildtest_full.log | grep -e "^MakeCommand" -e "^\[" -e "^\[" -e "Compiler " -e "\*\*\*Failed" -e "\.\.\.   Passed" -e " tests passed\," '
    after_script:
        # Write Selection of the output into the terminal and therefore to GITLAB
        # Output 200 lines for any failing test
        - grep -B 200 '*Failed\|*Timeout' ../buildtest_full.log || true
        - sed -n '/tests passed,/,//p' ../buildtest_full.log
        # Specify which configuration was tested by this pipeline
        - "echo Baci build type: $CTEST_BUILD_TYPE_GITLAB"
        - "echo Run tests matching expression: $TEST_TAG [{.} all tests, {} no test]"
        - "echo Excluded tests: $CTEST_EXCLUDE_STRING [{} no test excluded]"
        # Move the log file to the source folder, so it can be found by artifacts.
        - mv ../buildtest_full.log buildtest_full.log
    artifacts:
        name: "$CI_JOB_NAME-$CI_JOB_ID"
        paths:
            - buildtest_full.log
        when: on_failure
        expire_in: 4 weeks
    only:
        refs:
            - web
    except:
        variables:
            - $GITLAB_SCHEDULER_TYPE == "1"
            - $GITLAB_SCHEDULER_TYPE == "2"
            - $GITLAB_SCHEDULER_TYPE == "3"

# This kind of job is started by a weekly scheduler, with the variable
# $GITLAB_SCHEDULER_TYPE = "3"
# Full tests with coverage are performed
# A coverage report is created
.buildtest_coverage_weekly: &buildtest_coverage_weekly
    stage: buildtest
    script:
        # Specify which configuration is tested by this pipeline
        - "echo Baci build type: $CTEST_BUILD_TYPE_GITLAB"
        - "echo Run tests matching expression: $TEST_TAG [{.} all tests, {} no test]"
        - "echo Excluded tests: $CTEST_EXCLUDE_STRING [{} no test excluded]"
        # Delete old build files.
        - rm -rf ../baci-build/
        # Clear eventual ccache cache.
        - 'if [ -x "$(command -v ccache)" ]; then ccache -C -z; echo "ccache cache cleared"; fi'
        # Output to log because it is too much for the gitlab console.
        - 'ctest -S $CI_PROJECT_DIR/tests/testconfig/test_release.cmake -VV -E "$CTEST_EXCLUDE_STRING" -R "$TEST_TAG" | tee ../buildtest_weekly_coverage.log | grep -e "^MakeCommand" -e "^\[" -e "^\[" -e "Compiler " -e "\*\*\*Failed" -e "\.\.\.   Passed" -e " tests passed\," '
        # generate the baci_coverage.info based on tests run above
        - lcov --capture --directory ../baci-build/ --output-file baci_coverage.info
        # generate the html version of the coverage report
        - genhtml baci_coverage.info --output-directory coverage_report/ | tee genhtml_weekly_coverage.log
    # update (push) the cache of the weekly coverage report:
    # cache can be used to pass data between pipelines (in contrast to artifacts that pass data from stage to stage in a
    # single pipeline)
    cache:
        key: cache-weekly-coverage-report
        paths:
            - coverage_report/
            # the log is needed to print the weekly value of total line coverage in daily and minimal master pipelines
            - genhtml_weekly_coverage.log
        policy: push
    after_script:
        # Write Selection of the output into the terminal and therefore to GITLAB
        # Output 200 lines for any failing test
        - grep -B 200 '*Failed\|*Timeout' ../buildtest_weekly_coverage.log || true
        - sed -n '/tests passed,/,//p' ../buildtest_weekly_coverage.log
        # Specify which configuration was tested by this pipeline
        - "echo Baci build type: $CTEST_BUILD_TYPE_GITLAB"
        - "echo Run tests matching expression: $TEST_TAG [{.} all tests, {} no test]"
        - "echo Excluded tests: $CTEST_EXCLUDE_STRING [{} no test excluded]"
        # Move the log file to the source folder, so it can be found by artifacts.
        - mv ../buildtest_weekly_coverage.log buildtest_weekly_coverage.log
    # store the coverage report in an artifact so that the subsequent (obligatory) pages job can find it
    artifacts:
        name: "$CI_JOB_NAME-$CI_JOB_ID"
        paths:
            - buildtest_weekly_coverage.log
            - genhtml_weekly_coverage.log
            - coverage_report/
        # upload .log on_failure and coverage_report/ on_success:
        # currently there is no option to have multiple artifacts with different when: options
        # -> always upload artifacts of this job
        when: always
        expire_in: 4 weeks
    only:
        variables:
            - $GITLAB_SCHEDULER_TYPE == "3"

# This kind of job is started by a daily scheduler, with the variable
# $GITLAB_SCHEDULER_TYPE = "1"
# Full tests are performed.
.buildtest_daily: &buildtest_daily
    stage: buildtest
    script:
        # Specify which configuration is tested by this pipeline
        - "echo Nightly Test Release"
        - "echo Baci build type: $CTEST_BUILD_TYPE_GITLAB"
        - "echo Run tests matching expression: $TEST_TAG [{.} all tests, {} no test]"
        - "echo Excluded tests: $CTEST_EXCLUDE_STRING [{} no test excluded]"
        # Delete old build files.
        - rm -rf ../baci-build/
        # Clear eventual ccache cache.
        - 'if [ -x "$(command -v ccache)" ]; then ccache -C -z; echo "ccache cache cleared"; fi'
        # Output to log because it is too much for the gitlab console.
        - 'ctest -S $CI_PROJECT_DIR/tests/testconfig/test_release.cmake -VV -E "$CTEST_EXCLUDE_STRING" -R "$TEST_TAG" | tee ../buildtest_daily.log | grep -e "^MakeCommand" -e "^\[" -e "^\[" -e "Compiler " -e "\*\*\*Failed" -e "\.\.\.   Passed" -e " tests passed\,"'
    after_script:
        # Write Selection of the output into the terminal and therefore to GITLAB
        # Output 200 lines for any failing test
        - grep -B 200 '*Failed\|*Timeout' ../buildtest_daily.log || true
        - sed -n '/tests passed,/,//p' ../buildtest_daily.log
        # Specify which configuration was tested by this pipeline
        - "echo Baci build type: $CTEST_BUILD_TYPE_GITLAB"
        - "echo Run tests matching expression: $TEST_TAG [{.} all tests, {} no test]"
        - "echo Excluded tests: $CTEST_EXCLUDE_STRING [{} no test excluded]"
        # Move the log file to the source folder, so it can be found by artifacts.
        - mv ../buildtest_daily.log buildtest_daily.log
    artifacts:
        name: "$CI_JOB_NAME-$CI_JOB_ID"
        paths:
            - buildtest_daily.log
        when: on_failure
        expire_in: 4 weeks
    only:
        variables:
            - $GITLAB_SCHEDULER_TYPE == "1"

# This kind of job is started by a daily scheduler, with the variable
# $GITLAB_SCHEDULER_TYPE = "2"
# Debug tests are performed.
.buildtest_daily_debug: &buildtest_daily_debug
    stage: buildtest
    script:
        # Specify which configuration is tested by this pipeline
        - "echo Nightly Test Debug"
        - "echo Baci build type: $CTEST_BUILD_TYPE_GITLAB"
        - "echo Run tests matching expression: $TEST_TAG [{.} all tests, {} no test]"
        - "echo Excluded tests: $CTEST_EXCLUDE_STRING [{} no test excluded]"
        # Delete old build files.
        - rm -rf ../baci-build/
        # Clear eventual ccache cache.
        - 'if [ -x "$(command -v ccache)" ]; then ccache -C -z; echo "ccache cache cleared"; fi'
        # Output to log because it is too much for the gitlab console.
        - 'ctest -S $CI_PROJECT_DIR/tests/testconfig/test_debug.cmake -VV -E "$CTEST_EXCLUDE_STRING" | tee ../buildtest_daily_debug.log | grep -e "^MakeCommand" -e "^\[" -e "^\[" -e "Compiler " -e "\*\*\*Failed" -e "\.\.\.   Passed" -e " tests passed\,"'
    after_script:
        # Write Selection of the output into the terminal and therefore to GITLAB
        # Output 200 lines for any failing test
        - grep -B 200 '*Failed\|*Timeout' ../buildtest_daily_debug.log || true
        - sed -n '/tests passed,/,//p' ../buildtest_daily_debug.log
        # Specify which configuration was tested by this pipeline
        - "echo Baci build type: $CTEST_BUILD_TYPE_GITLAB"
        - "echo Run tests matching expression: $TEST_TAG [{.} all tests, {} no test]"
        - "echo Excluded tests: $CTEST_EXCLUDE_STRING [{} no test excluded]"
        # Move the log file to the source folder, so it can be found by artifacts.
        - mv ../buildtest_daily_debug.log buildtest_daily_debug.log
    artifacts:
        name: "$CI_JOB_NAME-$CI_JOB_ID"
        paths:
            - buildtest_daily_debug.log
        when: on_failure
        expire_in: 4 weeks
    only:
        variables:
            - $GITLAB_SCHEDULER_TYPE == "2"


# This kind of job is started when a user triggers a job in the gitlab UI.
#
# The doxygen_web job is meant for merge request testing.
.doxygen_web: &doxygen_web
    stage: doxygen
    script:
        - "echo Doxygen"
        # Delete old build files.
        - rm -rf ../baci-build/
        # Output to log because it is too much for the gitlab console.
        - "ctest -S $CI_PROJECT_DIR/tests/testconfig/test_doxygen.cmake -VV > ../doxygen.log"
        # Throw error if there are Latex errors in doxygen comments. Latex errors can be uniquely identified by a line starting with "! ".
        - if grep -qE '^! ' ../doxygen.log; then echo "Found at least one LaTeX error during doxygen build."; exit 1; else echo "Doxygen builds without LaTeX errors."; fi
    after_script:
        # Write Selection of the output into the terminal and therefore to GITLAB
        - sed -n '/* Extra verbosity turned on/,/Test project /p' ../doxygen.log
        # Write information about possible Latex errors to terminal
        - if grep -qE '^! ' ../doxygen.log; then echo "Found at least one LaTeX error during doxygen build."; else echo "Doxygen builds without LaTeX errors."; fi
        # Move the log file to the source folder, so it can be found by artifacts.
        - mv ../doxygen.log doxygen.log
    artifacts:
        name: "$CI_JOB_NAME-$CI_JOB_ID"
        paths:
            - doxygen.log
        when: on_failure
        expire_in: 4 weeks
    only:
        refs:
            - web
    except:
        variables:
            - $GITLAB_SCHEDULER_TYPE == "3"


# This kind of job is started by a daily scheduler, with the variable
# $GITLAB_SCHEDULER_TYPE = "1"
# Doxygen is build and moved to a folder with known path.
#
# The doxygen job is meant for nightly testing. It also provides doxygen output
# to be copied to $DOXYGEN_PATH.
.doxygen: &doxygen
    stage: doxygen
    script:
        - "echo Doxygen"
        # Delete old build files.
        - rm -rf ../baci-build/
        # Output to log because it is too much for the gitlab console.
        - "ctest -S $CI_PROJECT_DIR/tests/testconfig/test_doxygen.cmake -VV > ../doxygen.log"
        # Throw error if there are Latex errors in doxygen comments. Latex errors can be uniquely identified by a line starting with "! ".
        - if grep -qE '^! ' ../doxygen.log; then echo "Found at least one LaTeX error during doxygen build."; exit 1; else echo "Doxygen builds without LaTeX errors."; fi
        # Copy final doxygen files to pre-defined location
        - "cp -r $CI_PROJECT_DIR/../baci-build/doc/html $DOXYGEN_PATH"
    after_script:
        # Write Selection of the output into the terminal and therefore to GITLAB
        - sed -n '/* Extra verbosity turned on/,/Test project /p' ../doxygen.log
        # Write information about possible Latex errors to terminal
        - if grep -qE '^! ' ../doxygen.log; then echo "Found at least one LaTeX error during doxygen build."; else echo "Doxygen builds without LaTeX errors."; fi
        # Move the log file to the source folder, so it can be found by artifacts.
        - mv ../doxygen.log doxygen.log
    artifacts:
        name: "$CI_JOB_NAME-$CI_JOB_ID"
        paths:
            - doxygen.log
        when: on_failure
        expire_in: 4 weeks
    only:
        variables:
            # Only build doxygen during nightly tests.
            - $GITLAB_SCHEDULER_TYPE == "1"


#-------------------------------------------------------------------------------
# Stages during testing.
#-------------------------------------------------------------------------------

stages:
    - checkcode
    - buildtest
    - doxygen
    - pages


#-------------------------------------------------------------------------------
# Actual jobs for testing.
#-------------------------------------------------------------------------------

# ALL---------------------------------------------------------------------------

checkcode:
    stage: checkcode
    script:
        - "echo code check"
        - cd ../baci
        - bash utilities/code_checks/check_format_and_header
    artifacts:
        name: "$CI_JOB_NAME-$CI_JOB_ID"
        paths:
            - wrong_clang_format.txt
            - wrong_headers.txt
        when: on_failure
        expire_in: 4 weeks
    only:
        - master
        - web
    except:
        variables:
            - $GITLAB_SCHEDULER_TYPE == "2"
            - $GITLAB_SCHEDULER_TYPE == "3"
    tags:
        - all


# IMCS--------------------------------------------------------------------------

imcs-buildtest_minimal:
    <<: *buildtest_minimal
    variables:
        CTEST_CONFIGURE_POSTFIX: ""
        CTEST_MAKE: "make full -j3"
        CTEST_BUILD_NAME_GITLAB: "imcs-workstation-baci-Q1-2015-minimal-GITLAB"
        CTEST_BUILD_CONFIG_GITLAB: "imcs_workstation.config"
        CTEST_DROP_SITE_CDASH_GITLAB: "0"
        CTEST_DROP_SITE_GITLAB: "jacobi.lnm.mw.tum.de"
        CTEST_DROP_LOCATION_GITLAB: "/cdash/submit.php?project=baci"
    tags:
        - imcs-minimal

imcs-buildtest_full:
    <<: *buildtest_full
    variables:
        CTEST_CONFIGURE_POSTFIX: ""
        CTEST_MAKE: "make full -j3"
        CTEST_BUILD_NAME_GITLAB: "imcs-workstation-baci-Q1-2015-$TEST_TAG-GITLAB"
        CTEST_BUILD_CONFIG_GITLAB: "imcs_workstation.config"
        CTEST_DROP_SITE_CDASH_GITLAB: "0"
        CTEST_DROP_SITE_GITLAB: "jacobi.lnm.mw.tum.de"
        CTEST_DROP_LOCATION_GITLAB: "/cdash/submit.php?project=baci"
    tags:
        - imcs-full

imcs-buildtest_daily:
    <<: *buildtest_daily
    variables:
        CTEST_CONFIGURE_POSTFIX: ""
        CTEST_MAKE: "make full -j3"
        CTEST_BUILD_NAME_GITLAB: "imcs-workstation-baci-Q1-2015-GITLAB"
        CTEST_BUILD_CONFIG_GITLAB: "imcs_workstation.config"
        CTEST_DROP_SITE_CDASH_GITLAB: "0"
        CTEST_DROP_SITE_GITLAB: "jacobi.lnm.mw.tum.de"
        CTEST_DROP_LOCATION_GITLAB: "/cdash/submit.php?project=baci"
    tags:
        - imcs-nightly-full

imcs-buildtest_daily_debug:
    <<: *buildtest_daily_debug
    variables:
        CTEST_CONFIGURE_POSTFIX: ""
        CTEST_MAKE: "make full -j3"
        CTEST_BUILD_NAME_GITLAB: "imcs-workstation-baci-Q1-2015-DEBUG-GITLAB"
        CTEST_BUILD_CONFIG_GITLAB: "imcs_workstation.config"
        CTEST_DROP_SITE_CDASH_GITLAB: "0"
        CTEST_DROP_SITE_GITLAB: "jacobi.lnm.mw.tum.de"
        CTEST_DROP_LOCATION_GITLAB: "/cdash/submit.php?project=baci"
    tags:
        - imcs-nightly-debug

.imcs-doxygen:
    <<: *doxygen
    variables:
        CTEST_OPTION_IMCS: "-E '-*pp*|-*energy*'"
        CTEST_CONFIGURE_POSTFIX: ""
        CTEST_MAKE: "make documentation"
        CTEST_BUILD_NAME_GITLAB: "Doxygen-GITLAB"
        CTEST_BUILD_CONFIG_GITLAB: "imcs_workstation.config"
        CTEST_DROP_SITE_CDASH_GITLAB: "0"
        CTEST_DROP_SITE_GITLAB: "jacobi.lnm.mw.tum.de"
        CTEST_DROP_LOCATION_GITLAB: "/cdash/submit.php?project=baci"
        # Path on testing machine where doxygen will be copied to.
        DOXYGEN_PATH: "TBD"
    tags:
        - imcs-nightly


# LNM---------------------------------------------------------------------------

lnm-buildtest_minimal:
    <<: *buildtest_minimal
    variables:
        CTEST_MAKE: "make full -j3"
        CTEST_BUILD_NAME_GITLAB: "CentOS-baci-Q1-2015-minimal-GITLAB"
        CTEST_BUILD_CONFIG_GITLAB: "centos74_Q12015.config"
        CTEST_DROP_SITE_CDASH_GITLAB: "1"
        CTEST_DROP_SITE_GITLAB: "jacobi.lnm.mw.tum.de"
        CTEST_DROP_LOCATION_GITLAB: "/cdash/submit.php?project=baci"
    tags:
        - lnm-release-mastermod-minimal

lnm-buildtest_full:
    <<: *buildtest_full
    variables:
        CTEST_MAKE: "make full -j3"
        CTEST_BUILD_NAME_GITLAB: "CentOS-baci-Q1-2015-$TEST_TAG-GITLAB"
        CTEST_BUILD_CONFIG_GITLAB: "centos74_Q12015.config"
        CTEST_DROP_SITE_CDASH_GITLAB: "0"
        CTEST_DROP_SITE_GITLAB: "jacobi.lnm.mw.tum.de"
        CTEST_DROP_LOCATION_GITLAB: "/cdash/submit.php?project=baci"
    tags:
        - lnm-release-user-full

lnm-buildtest_coverage_weekly:
    <<: *buildtest_coverage_weekly
    variables:
        # increase the global test timeout
        GLOBAL_TEST_TIMEOUT: "4000"
        # increase the unit test timeout
        UNITTEST_TIMEOUT: "50"
        # enable coverage option of ctest
        CTEST_CONFIGURE_POSTFIX: "--coverage"
        CTEST_MAKE: "make full -j4"
        CTEST_BUILD_NAME_GITLAB: "CentOS-baci-Q1-2015-coverage-GITLAB"
        CTEST_BUILD_CONFIG_GITLAB: "centos74_Q12015.config"
        CTEST_DROP_SITE_CDASH_GITLAB: "0"
        CTEST_DROP_SITE_GITLAB: "jacobi.lnm.mw.tum.de"
        CTEST_DROP_LOCATION_GITLAB: "/cdash/submit.php?project=baci"
    tags:
        - lnm-release-weekly-coverage

pages: # job name needs to be pages
    stage: pages
    variables:
        # stage operates exclusively on artifacts. No need for source code.
        GIT_STRATEGY: fetch
    # skip the download of artifacts from previous stages. Rely solely on cache
    dependencies: []
    script:
        # print the weekly measured coverage rate
        - "echo 'Weekly measured'"
        - grep "Overall coverage rate:" -A 2 genhtml_weekly_coverage.log
        # move weekly created coverage report to public folder (which is the path for GitLab Pages content)
        - mv coverage_report/ public/
    cache:
        key: cache-weekly-coverage-report
        paths:
            - coverage_report/
            - genhtml_weekly_coverage.log
        policy: pull
    artifacts:
        # store the public path in artifact
        # this is needed since in a subsequent deploy stage (automatically generated by GitLab)
        # the content of the below artifact is published on GitLab Pages
        paths:
            - public
        expire_in: 1 weeks
    only:
        refs:
            - master
    tags:
        - lnm-release-weekly-coverage

lnm-buildtest_daily:
    <<: *buildtest_daily
    variables:
        CTEST_MAKE: "make full -j3"
        CTEST_BUILD_NAME_GITLAB: "CentOS-baci-Q1-2015-GITLAB"
        CTEST_BUILD_CONFIG_GITLAB: "centos74_Q12015.config"
        CTEST_DROP_SITE_CDASH_GITLAB: "1"
        CTEST_DROP_SITE_GITLAB: "jacobi.lnm.mw.tum.de"
        CTEST_DROP_LOCATION_GITLAB: "/cdash/submit.php?project=baci"
    tags:
        - lnm-release-nightly-full

lnm-buildtest_daily_bruteforce:
    <<: *buildtest_daily
    variables:
        TEST_TAG: ""
        CTEST_FAIL_ON_WARNING: "0"
        CTEST_CONFIGURE_POSTFIX: ""
        CTEST_MAKE: "make full -j3"
        CTEST_BUILD_NAME_GITLAB: "CentOS-baci-Q1-2015-BruteForce-GITLAB"
        CTEST_BUILD_CONFIG_GITLAB: "bruteforce_Q12015_icc.config"
        CTEST_DROP_SITE_CDASH_GITLAB: "1"
        CTEST_DROP_SITE_GITLAB: "jacobi.lnm.mw.tum.de"
        CTEST_DROP_LOCATION_GITLAB: "/cdash/submit.php?project=baci"
    tags:
        - lnm-release-nightly-build-bruteforce
    only:
        variables:
            - $GITLAB_SCHEDULER_LNM_BRUTEFORCE == "1"

lnm-buildtest_daily_deep:
    <<: *buildtest_daily
    variables:
        TEST_TAG: ""
        CTEST_FAIL_ON_WARNING: "0"
        CTEST_MAKE: "make full -j3"
        CTEST_BUILD_NAME_GITLAB: "CentOS-baci-Q1-2015-Deep-GITLAB"
        CTEST_BUILD_CONFIG_GITLAB: "deep_cluster_Q12015_gcc48.config"
        CTEST_DROP_SITE_CDASH_GITLAB: "1"
        CTEST_DROP_SITE_GITLAB: "jacobi.lnm.mw.tum.de"
        CTEST_DROP_LOCATION_GITLAB: "/cdash/submit.php?project=baci"
    tags:
        - lnm-release-nightly-build-deep
    only:
        variables:
            - $GITLAB_SCHEDULER_LNM_DEEP == "1"

lnm-buildtest_daily_schmarrn:
    <<: *buildtest_daily
    variables:
        TEST_TAG: ""
        CTEST_FAIL_ON_WARNING: "0"
        CTEST_MAKE: "make -j3"
        CTEST_BUILD_NAME_GITLAB: "CentOS-baci-Q1-2015-Kaiser-GITLAB"
        CTEST_BUILD_CONFIG_GITLAB: "schmarrn_Q12015_gcc48_ACML_ompi162.config"
        CTEST_DROP_SITE_CDASH_GITLAB: "1"
        CTEST_DROP_SITE_GITLAB: "jacobi.lnm.mw.tum.de"
        CTEST_DROP_LOCATION_GITLAB: "/cdash/submit.php?project=baci"
    tags:
        - lnm-release-nightly-build-schmarrn
    only:
        variables:
            - $GITLAB_SCHEDULER_LNM_SCHMARRN == "1"


lnm-buildtest_daily_debug:
    <<: *buildtest_daily_debug
    variables:
        CTEST_MAKE: "make full -j3"
        CTEST_BUILD_NAME_GITLAB: "CentOS-baci-Q1-2015 DEBUG-GITLAB"
        CTEST_BUILD_CONFIG_GITLAB: "centos74_Q12015.config"
        CTEST_DROP_SITE_CDASH_GITLAB: "1"
        CTEST_DROP_SITE_GITLAB: "jacobi.lnm.mw.tum.de"
        CTEST_DROP_LOCATION_GITLAB: "/cdash/submit.php?project=baci"
    tags:
        - lnm-debug-nightly-full

lnm-doxygen-web:
    <<: *doxygen_web
    variables:
        CTEST_MAKE: "make documentation"
        CTEST_BUILD_NAME_GITLAB: "Doxygen-GITLAB"
        CTEST_BUILD_CONFIG_GITLAB: "centos74_Q12015.config"
        CTEST_DROP_SITE_CDASH_GITLAB: "0"
        CTEST_DROP_SITE_GITLAB: "jacobi.lnm.mw.tum.de"
        CTEST_DROP_LOCATION_GITLAB: "/cdash/submit.php?project=baci"
    tags:
        - lnm-release-user-full

lnm-doxygen:
    <<: *doxygen
    variables:
        CTEST_MAKE: "make documentation"
        CTEST_BUILD_NAME_GITLAB: "Doxygen-GITLAB"
        CTEST_BUILD_CONFIG_GITLAB: "centos74_Q12015.config"
        CTEST_DROP_SITE_CDASH_GITLAB: "1"
        CTEST_DROP_SITE_GITLAB: "jacobi.lnm.mw.tum.de"
        CTEST_DROP_LOCATION_GITLAB: "/cdash/submit.php?project=baci"
        # Path on testing machine where doxygen will be copied to.
        DOXYGEN_PATH: "/home/gitlab-runner/."
    tags:
        - lnm-nightly-doxygen
